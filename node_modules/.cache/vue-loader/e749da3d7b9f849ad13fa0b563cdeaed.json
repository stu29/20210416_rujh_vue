{"remainingRequest":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\src\\components\\main\\components\\user\\user.vue?vue&type=style&index=0&lang=css&","dependencies":[{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\src\\components\\main\\components\\user\\user.vue","mtime":1618817111118},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\postcss-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618890453389},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n.demo-upload-list{\n    display: inline-block;\n    width: 60px;\n    height: 60px;\n    text-align: center;\n    line-height: 60px;\n    border: 1px solid transparent;\n    border-radius: 4px;\n    overflow: hidden;\n    background: #fff;\n    position: relative;\n    box-shadow: 0 1px 1px rgba(0,0,0,.2);\n    margin-right: 4px;\n}\n.demo-upload-list img{\n    width: 100%;\n    height: 100%;\n}\n.demo-upload-list-cover{\n    display: none;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    background: rgba(0,0,0,.6);\n}\n.demo-upload-list:hover .demo-upload-list-cover{\n    display: block;\n}\n.demo-upload-list-cover i{\n    color: #fff;\n    font-size: 20px;\n    cursor: pointer;\n    margin: 0 2px;\n}\n",{"version":3,"sources":["user.vue"],"names":[],"mappings":";AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user.vue","sourceRoot":"src\\components\\main\\components\\user","sourcesContent":["<style>\r\n    .demo-upload-list{\r\n        display: inline-block;\r\n        width: 60px;\r\n        height: 60px;\r\n        text-align: center;\r\n        line-height: 60px;\r\n        border: 1px solid transparent;\r\n        border-radius: 4px;\r\n        overflow: hidden;\r\n        background: #fff;\r\n        position: relative;\r\n        box-shadow: 0 1px 1px rgba(0,0,0,.2);\r\n        margin-right: 4px;\r\n    }\r\n    .demo-upload-list img{\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .demo-upload-list-cover{\r\n        display: none;\r\n        position: absolute;\r\n        top: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        background: rgba(0,0,0,.6);\r\n    }\r\n    .demo-upload-list:hover .demo-upload-list-cover{\r\n        display: block;\r\n    }\r\n    .demo-upload-list-cover i{\r\n        color: #fff;\r\n        font-size: 20px;\r\n        cursor: pointer;\r\n        margin: 0 2px;\r\n    }\r\n</style>\r\n\r\n\r\n<template>\r\n  \r\n  <div class=\"user-avator-dropdown\">\r\n     <Badge :count=\"newsCount\" :offset=\"[20,5]\" class=\"mr-10\" >\r\n        <a href=\"http://localhost:8081/#/news/news\"><Icon type=\"ios-notifications-outline\" size=\"26\"></Icon></a>\r\n      </Badge>\r\n    <Dropdown @on-click=\"handleClick\">\r\n      <Avatar :src=\"userAvator\"/>\r\n      <Icon :size=\"18\" type=\"md-arrow-dropdown\"></Icon>\r\n      <DropdownMenu slot=\"list\">\r\n         <component2 v-if=\"viewAccessTwo\"> \r\n            <DropdownItem name=\"edit\" >编辑个人信息</DropdownItem>\r\n            <DropdownItem name=\"upassword\" >修改密码</DropdownItem>\r\n            <DropdownItem name=\"upic\" >修改头像</DropdownItem> \r\n         </component2> \r\n          <DropdownItem name=\"logout\">退出登录</DropdownItem>\r\n      </DropdownMenu>\r\n    </Dropdown>\r\n    <Modal\r\n     v-model=\"saveItem\"\r\n     :title=\"itemTitle\"\r\n     @on-cancel='closeSaveItem'>\r\n     <Form ref=\"formData\" :model=\"formData\" :label-width=\"80\">\r\n       <input type=\"hidden\" name='id' v-model=\"formData.userId\">\r\n       <FormItem label=\"姓名\">\r\n           <Input v-model=\"formData.name\" placeholder=\"请填写您的姓名\" :maxlength=\"10\"></Input>\r\n       </FormItem>\r\n       <FormItem label=\"手机号\">\r\n           <Input v-model=\"formData.phone\" placeholder=\"请填写您的手机号码\" :maxlength=\"11\"></Input>\r\n       </FormItem>\r\n     </Form>\r\n     <div slot=\"footer\">\r\n         <Button type=\"default\"  @click=\"closeSaveItem\">关闭</Button>\r\n         <Button type=\"primary\" :disabled='saveItemStatu'  @click=\"saveItemOk\">确认</Button>\r\n     </div>\r\n   </Modal> \r\n   <Modal\r\n     v-model=\"saveItem1\"\r\n     :title=\"itemTitle1\"\r\n     @on-cancel='closeSaveItem'>\r\n     <Form ref=\"formData\" :model=\"formData\" :label-width=\"80\">\r\n       <input type=\"hidden\" name='id' v-model=\"formData.userId\">\r\n         <FormItem label=\"旧密码\" >\r\n           <Input  v-model=\"formData.oldPassword\" placeholder=\"请填写您的旧密码\" :maxlength=\"11\"></Input>\r\n         </FormItem>\r\n         <FormItem label=\"新密码\">\r\n            <Input type='password' v-model=\"formData.newPassword\" placeholder=\"请填写您的新密码\" :maxlength=\"11\"></Input>\r\n          </FormItem>\r\n         <FormItem label=\"确认密码\" >\r\n            <Input type='password' v-model=\"formData.confirmPwd\" placeholder=\"请确认新密码\" :maxlength=\"11\"></Input>\r\n          </FormItem> \r\n     </Form>\r\n     <div slot=\"footer\">\r\n         <Button type=\"default\"  @click=\"closeSaveItem\">关闭</Button>\r\n         <Button type=\"primary\" :disabled='saveItemStatu'  @click=\"saveItemOk1\">确认</Button>\r\n     </div>\r\n   </Modal> \r\n\r\n   <Modal\r\n      v-model=\"upLoadPic\"\r\n      title=\"上传头像\"\r\n      @on-cancel='closeUpload'>\r\n      <div class=\"demo-upload-list\" v-for=\"item in uploadList\">\r\n          <img :src=\"item.url\">\r\n          <div class=\"demo-upload-list-cover\">\r\n              <Icon type=\"ios-trash-outline\" @click.native=\"handleRemove(item)\"></Icon>\r\n          </div>\r\n      </div>\r\n      <Upload\r\n          ref=\"upload\"\r\n          :show-upload-list=\"false\"\r\n          :default-file-list=\"defaultList\"\r\n          :on-success=\"handleSuccess\"\r\n          :format=\"['jpg','jpeg','png']\"\r\n          :max-size=\"2048\"\r\n          :on-format-error=\"handleFormatError\"\r\n          :on-exceeded-size=\"handleMaxSize\"\r\n          :before-upload=\"handleBeforeUpload\"\r\n          multiple\r\n          type=\"drag\"\r\n          action=\"/api/current/updateCurrentPic\"\r\n          :headers=\"{userId:userId}\"\r\n          style=\"display: inline-block;width:58px;\">\r\n          <div style=\"width: 58px;height:58px;line-height: 58px;\">\r\n              <Icon type=\"ios-camera\" size=\"20\"></Icon>\r\n          </div>\r\n      </Upload>\r\n      <div slot=\"footer\">\r\n          <Button type=\"default\"  @click=\"closeUpload\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal title=\"View Image\" v-model=\"picShow\">\r\n        <img :src=\"'https://o5wwk8baw.qnssl.com/' + imgName + '/large'\" v-if=\"picShow\" style=\"width: 100%\">\r\n    </Modal>\r\n </div>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\nimport './user.less'\r\nimport { hasOneOf } from '@/libs/tools'\r\nimport { mapActions } from 'vuex'\r\nimport ds from '@/assets/images/ds.png' \r\nimport { updateCurrent , updateCurrent1,removeCurrentPic,updateCurrentPic,selectNewsCount} from '@/api/data'\r\n\r\nexport default {\r\n // inject:['reload'],\r\n  name: 'User',\r\n  props: {\r\n    userAvator: {\r\n      type: String,\r\n      default: ''\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      formData:{},      //表单信息\r\n      saveItem:false,     //保存操作框\r\n      saveItemStatu:false,    //保存点击状态\r\n      itemTitle:'编辑个人信息',\r\n\r\n      saveItem1:false,\r\n      itemTitle1:'修改密码',\r\n\r\n      upLoadPic: false,   // 照片上传模态框\r\n      spicture:[],          //照片上传\r\n      teacherId:0,        //照片上传参数\r\n\r\n      // 图片上传\r\n      defaultList: [],\r\n      imgName: '',\r\n      picShow: false,\r\n      uploadList: [],\r\n\r\n      count:0,\r\n      content:ds.png,\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions([\r\n      'handleLogOut'\r\n    ]),\r\n    handleClick (name) {\r\n      switch (name) {\r\n        case 'logout':\r\n          this.handleLogOut().then(() => {\r\n            this.$router.push({\r\n              name: 'login'\r\n            })\r\n          })\r\n          break;\r\n        case 'edit':\r\n        //alert(1);\r\n        this.saveItem = true;\r\n        this.formData = this.$store.state.user;\r\n        break;\r\n        case 'upassword' :\r\n        this.saveItem1 = true;\r\n        this.formData = this.$store.state.user;\r\n        break;\r\n        case 'upic' :\r\n        this.upLoadPic = true;\r\n        console.log(JSON.stringify(this.$store.state.user))\r\n        this.userId = this.$store.state.user.userId;\r\n        var defaultPicObj = {};\r\n            defaultPicObj.name=this.$store.state.user.headPic;\r\n            defaultPicObj.url=this.$store.state.user.avatorImgPath;\r\n            this.uploadList.push(defaultPicObj);\r\n      }\r\n    },\r\n\r\n    closeUpload(){\r\n     alert(1);\r\n      this.upLoadPic = false;\r\n      this.defaultList=[];\r\n      this.uploadList=[];\r\n      location.reload();\r\n    },\r\n\r\n    // 图片上传\r\n    handleView (name) {\r\n        this.imgName = name;\r\n        this.picShow = true;\r\n    },\r\n    handleRemove (file) {\r\n        /*const fileList = this.$refs.upload.fileList;\r\n        this.$refs.upload.fileList.splice(fileList.indexOf(file), 1);*/\r\n        this.formData.id=this.userId;\r\n        this.formData.headPic=this.$store.state.user.headPic;\r\n        removeCurrentPic(this.formData).then(res => {\r\n            //console.log(JSON.stringify(res));\r\n            if(res.data.success){\r\n              this.$Message.success({\r\n              content:'删除头像成功'\r\n            });\r\n             this.uploadList.splice(this.uploadList.indexOf(file), 1)\r\n             //this.upLoadPic = false;\r\n             //that.pageInit();\r\n            }else if(res.data.errorMsg){\r\n              this.$Message.warning({\r\n                content:res.data.errorMsg\r\n              })\r\n            }\r\n          })\r\n    },\r\n     handleSuccess (res, file) {\r\n        //alert(1);\r\n        file.url = 'http://localhost:8081/picture/'+this.$store.state.user.headPic;\r\n        file.name = res.result.picName;\r\n        console.log(file.url);\r\n    },\r\n    handleFormatError (file) {\r\n        this.$Notice.warning({\r\n            title: '文件格式不正确',\r\n            desc: file.name + ' 的文件格式不正确,请选择jpg或png'\r\n        });\r\n    },\r\n    handleMaxSize (file) {\r\n        this.$Notice.warning({\r\n            title: '超过文件大小限制',\r\n            desc: file.name + ' 超出文件大小限制,请选择小于2M的图片上传'\r\n        });\r\n    },\r\n     handleBeforeUpload(file) {\r\n        // 创建一个 FileReader 对象\r\n        let reader = new FileReader()\r\n        // readAsDataURL 方法用于读取指定 Blob 或 File 的内容\r\n        // 当读操作完成，readyState 变为 DONE，loadend 被触发，此时 result 属性包含数据：URL（以 base64 编码的字符串表示文件的数据）\r\n        // 读取文件作为 URL 可访问地址\r\n        reader.readAsDataURL(file)\r\n\r\n        const _this = this\r\n        reader.onloadend = function (e) {\r\n            file.url = reader.result\r\n            _this.uploadList.push(file)\r\n        }\r\n        const check = this.uploadList.length < 1;\r\n        if (!check) {\r\n            this.$Notice.warning({\r\n                title: '最多可上传1张图片'\r\n            });\r\n        }\r\n        return check;\r\n    },\r\n   // 关闭保存项目模态框\r\n    closeSaveItem(){\r\n      this.formData = {};\r\n      this.saveItem = false;\r\n      this.targetKeys=[];\r\n      this.saveItem1 = false;\r\n    },\r\n    saveItemOk(){\r\n      var that = this;\r\n      var formData = this.formData;\r\n      console.log(JSON.stringify(formData))\r\n      if(!formData.name){\r\n        this.$Message.warning({\r\n          content:'请填写您的姓名！'\r\n        });\r\n        return;\r\n      }else if (!/[\\u4e00-\\u9fa5_a-zA-Z]+$/.test(formData.name)){\r\n        this.$Message.warning({\r\n          content:'请填写正确的姓名'\r\n        });\r\n        return;\r\n      };\r\n      \r\n      if(!formData.phone){\r\n        this.$Message.warning({\r\n          content:'请填写您的手机号'\r\n        });\r\n        return;\r\n      }else if (!/^1(3|4|5|6|7|8)\\d{9}$/.test(formData.phone)){\r\n        this.$Message.warning({\r\n          content:'请填写正确的手机号'\r\n        });\r\n        return;\r\n      };\r\n        updateCurrent(this.formData).then(res => {\r\n          that.saveItemStatu = false;\r\n          if(res.data.success){\r\n            this.$Message.success({\r\n              content:'修改用户成功'\r\n            });\r\n            that.saveItem = false;\r\n            that.pageInit();\r\n          }else if(res.data.errorMsg){\r\n            this.$Message.warning({\r\n              content:res.data.errorMsg\r\n            })\r\n          }\r\n        })\r\n    },\r\n\r\n\r\n\r\n    saveItemOk1(){\r\n      var that = this;\r\n      var formData = this.formData;\r\n      //console.log('55555'+JSON.stringify(formData))\r\n        if(!formData.oldPassword){\r\n          this.$Message.warning({\r\n            content:'请填写您的旧密码！'\r\n          });\r\n          return;\r\n        }else if (!/^[\\w_-]{5,11}$/.test(formData.oldPassword)){\r\n          this.$Message.warning({\r\n            content:'请填写5-11密码'\r\n          });\r\n          return;\r\n        };\r\n        if(!formData.newPassword){\r\n          this.$Message.warning({\r\n            content:'请填写您的新密码！'\r\n          });\r\n          return;\r\n        }else if (!/^[\\w_-]{5,11}$/.test(formData.newPassword)){\r\n          this.$Message.warning({\r\n            content:'请填写5-11密码'\r\n          });\r\n          return;\r\n        };\r\n        if(!formData.confirmPwd){\r\n          this.$Message.warning({\r\n            content:'请确认您的密码！'\r\n          });\r\n          return;\r\n        }else if (formData.confirmPwd !== formData.newPassword){\r\n          this.$Message.warning({\r\n            content:'两次密码请保持一致'\r\n          });\r\n          return;\r\n        };\r\n        //console.log(JSON.stringify(this.identity))\r\n    //    this.saveItemStatu = true;\r\n        updateCurrent1(this.formData).then(res => {\r\n          // var that = this;\r\n          that.saveItemStatu = false;\r\n          if(res.data.success){\r\n            this.$Message.success({\r\n              content:'修改密码成功'\r\n            });\r\n            that.saveItem1 = false;\r\n            that.pageInit();\r\n          }else if(res.data.errorMsg){\r\n            this.$Message.warning({\r\n              content:res.data.errorMsg\r\n            })\r\n          }\r\n        })\r\n    }\r\n  },\r\n  mounted () {\r\n    selectNewsCount().then(res => {\r\n      if(res.data.success){\r\n        this.count = res.data.result.count;\r\n      }else if(res.data.errorMsg){\r\n        this.$Message.warning({\r\n          content:res.data.errorMsg\r\n        })\r\n      }\r\n    })\r\n  },\r\n  computed: { \r\n      access () {\r\n        return this.$store.state.user.access\r\n      },\r\n\r\n      newsCount(){\r\n        return this.$store.state.user.newsCount\r\n      },\r\n      //所有权限\r\n      viewAccessAll () {\r\n        return hasOneOf(['superAdmin', 'teacher','student'], this.access)\r\n      },\r\n      //部分权限\r\n      viewAccessTwo () {\r\n        return hasOneOf(['teacher','student'], this.access)\r\n      }\r\n    }\r\n}\r\n\r\n</script>\r\n"]}]}
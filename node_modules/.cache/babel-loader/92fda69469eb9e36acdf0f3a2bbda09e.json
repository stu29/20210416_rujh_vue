{"remainingRequest":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\src\\libs\\axios.js","dependencies":[{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\src\\libs\\axios.js","mtime":1567648062313},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\.babelrc","mtime":1567648062203},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618890453389},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1529635966000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.object.assign\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport _classCallCheck from \"C:\\\\Users\\\\\\u8339\\u5BB6\\u8C6A\\\\Desktop\\\\20210416_rujh_vue\\\\20210416_rujh_vue\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\\\u8339\\u5BB6\\u8C6A\\\\Desktop\\\\20210416_rujh_vue\\\\20210416_rujh_vue\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/createClass\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport axios from 'axios';\nimport store from '@/store';\nimport { getToken } from '@/libs/util'; // import { Spin } from 'iview'\n\nvar addErrorLog = function addErrorLog(errorInfo) {\n  var statusText = errorInfo.statusText,\n      status = errorInfo.status,\n      responseURL = errorInfo.request.responseURL;\n  var info = {\n    type: 'ajax',\n    code: status,\n    mes: statusText,\n    url: responseURL\n  };\n  if (!responseURL.includes('save_error_logger')) store.dispatch('addErrorLog', info);\n};\n\nvar HttpRequest =\n/*#__PURE__*/\nfunction () {\n  function HttpRequest() {\n    var baseUrl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : baseURL;\n\n    _classCallCheck(this, HttpRequest);\n\n    this.baseUrl = baseUrl;\n    this.queue = {};\n  }\n\n  _createClass(HttpRequest, [{\n    key: \"getInsideConfig\",\n    value: function getInsideConfig() {\n      var config = {\n        baseURL: this.baseUrl,\n        headers: {\n          // 'Content-Type':'application/json',\n          'Access-Token': getToken()\n        }\n      };\n      return config;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy(url) {\n      delete this.queue[url];\n\n      if (!Object.keys(this.queue).length) {// Spin.hide()\n      }\n    }\n  }, {\n    key: \"interceptors\",\n    value: function interceptors(instance, url) {\n      var _this = this;\n\n      // 请求拦截\n      instance.interceptors.request.use(function (config) {\n        // 添加全局的loading...\n        if (!Object.keys(_this.queue).length) {// Spin.show() // 不建议开启，因为界面不友好\n        }\n\n        _this.queue[url] = true;\n        return config;\n      }, function (error) {\n        return Promise.reject(error);\n      }); // 响应拦截\n\n      instance.interceptors.response.use(function (res) {\n        _this.destroy(url);\n\n        var data = res.data,\n            status = res.status;\n        return {\n          data: data,\n          status: status\n        };\n      }, function (error) {\n        _this.destroy(url);\n\n        addErrorLog(error.response);\n        return Promise.reject(error);\n      });\n    }\n  }, {\n    key: \"request\",\n    value: function request(options) {\n      var instance = axios.create();\n      options = Object.assign(this.getInsideConfig(), options);\n      this.interceptors(instance, options.url);\n      return instance(options);\n    }\n  }]);\n\n  return HttpRequest;\n}();\n\nexport default HttpRequest;",{"version":3,"sources":["src\\libs\\axios.js"],"names":["axios","store","getToken","addErrorLog","statusText","errorInfo","status","responseURL","request","info","type","code","mes","url","includes","dispatch","HttpRequest","baseUrl","baseURL","queue","config","headers","Object","keys","length","instance","interceptors","use","Promise","reject","error","response","destroy","data","res","options","create","assign","getInsideConfig"],"mappings":";;;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,KAAP,MAAkB,SAAlB;AACA,SAASC,QAAT,QAAyB,aAAzB,C,CACA;;AACA,IAAMC,cAAc,SAAdA,WAAc,YAAa;AAAA,MACvBC,UADuB,GAC0BC,SAD1B,CACvBD,UADuB;AAAA,MACXE,MADW,GAC0BD,SAD1B,CACXC,MADW;AAAA,MACQC,WADR,GAC0BF,SAD1B,CACHG,OADG,CACQD,WADR;AAE/B,MAAIE,OAAO;AACTC,UAAM,MADG;AAETC,UAAML,MAFG;AAGTM,SAAKR,UAHI;AAITS,SAAKN;AAJI,GAAX;AAMA,MAAI,CAACA,YAAYO,QAAZ,CAAqB,mBAArB,CAAL,EAAgDb,MAAMc,QAAN,CAAe,aAAf,EAA8BN,IAA9B;AACjD,CATD;;IAWMO,W;;;AACJ,yBAAgC;AAAA,QAAnBC,OAAmB,uEAATC,OAAS;;AAAA;;AAC9B,SAAKD,OAAL,GAAeA,OAAf;AACA,SAAKE,KAAL,GAAa,EAAb;AACD;;;;sCACkB;AACjB,UAAMC,SAAS;AACbF,iBAAS,KAAKD,OADD;AAEbI,iBAAS;AACP;AACA,0BAAgBnB;AAFT;AAFI,OAAf;AAOA,aAAOkB,MAAP;AACD;;;4BACQP,G,EAAK;AACZ,aAAO,KAAKM,KAAL,CAAWN,GAAX,CAAP;;AACA,UAAI,CAACS,OAAOC,IAAP,CAAY,KAAKJ,KAAjB,EAAwBK,MAA7B,EAAqC,CACnC;AACD;AACF;;;iCACaC,Q,EAAUZ,G,EAAK;AAAA;;AAC3B;AACAY,eAASC,YAAT,CAAsBlB,OAAtB,CAA8BmB,GAA9B,CAAkC,kBAAU;AAC1C;AACA,YAAI,CAACL,OAAOC,IAAP,CAAY,MAAKJ,KAAjB,EAAwBK,MAA7B,EAAqC,CACnC;AACD;;AACD,cAAKL,KAAL,CAAWN,GAAX,IAAkB,IAAlB;AACA,eAAOO,MAAP;AACD,OAPD,EAOG,iBAAS;AACV,eAAOQ,QAAQC,MAAR,CAAeC,KAAf,CAAP;AACD,OATD,EAF2B,CAY3B;;AACAL,eAASC,YAAT,CAAsBK,QAAtB,CAA+BJ,GAA/B,CAAmC,eAAO;AACxC,cAAKK,OAAL,CAAanB,GAAb;;AADwC,YAEhCoB,IAFgC,GAEfC,GAFe,CAEhCD,IAFgC;AAAA,YAE1B3B,MAF0B,GAEf4B,GAFe,CAE1B5B,MAF0B;AAGxC,eAAO;AAAE2B,oBAAF;AAAQ3B;AAAR,SAAP;AACD,OAJD,EAIG,iBAAS;AACV,cAAK0B,OAAL,CAAanB,GAAb;;AACAV,oBAAY2B,MAAMC,QAAlB;AACA,eAAOH,QAAQC,MAAR,CAAeC,KAAf,CAAP;AACD,OARD;AASD;;;4BACQK,O,EAAS;AAChB,UAAMV,WAAWzB,MAAMoC,MAAN,EAAjB;AACAD,gBAAUb,OAAOe,MAAP,CAAc,KAAKC,eAAL,EAAd,EAAsCH,OAAtC,CAAV;AACA,WAAKT,YAAL,CAAkBD,QAAlB,EAA4BU,QAAQtB,GAApC;AACA,aAAOY,SAASU,OAAT,CAAP;AACD;;;;;;AAEH,eAAenB,WAAf","sourceRoot":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue","sourcesContent":["import axios from 'axios'\r\nimport store from '@/store'\r\nimport { getToken } from '@/libs/util'\r\n// import { Spin } from 'iview'\r\nconst addErrorLog = errorInfo => {\r\n  const { statusText, status, request: { responseURL } } = errorInfo\r\n  let info = {\r\n    type: 'ajax',\r\n    code: status,\r\n    mes: statusText,\r\n    url: responseURL\r\n  }\r\n  if (!responseURL.includes('save_error_logger')) store.dispatch('addErrorLog', info)\r\n}\r\n\r\nclass HttpRequest {\r\n  constructor (baseUrl = baseURL) {\r\n    this.baseUrl = baseUrl\r\n    this.queue = {}\r\n  }\r\n  getInsideConfig () {\r\n    const config = {\r\n      baseURL: this.baseUrl,\r\n      headers: {\r\n        // 'Content-Type':'application/json',\r\n        'Access-Token': getToken()\r\n      }\r\n    }\r\n    return config\r\n  }\r\n  destroy (url) {\r\n    delete this.queue[url]\r\n    if (!Object.keys(this.queue).length) {\r\n      // Spin.hide()\r\n    }\r\n  }\r\n  interceptors (instance, url) {\r\n    // 请求拦截\r\n    instance.interceptors.request.use(config => {\r\n      // 添加全局的loading...\r\n      if (!Object.keys(this.queue).length) {\r\n        // Spin.show() // 不建议开启，因为界面不友好\r\n      }\r\n      this.queue[url] = true\r\n      return config\r\n    }, error => {\r\n      return Promise.reject(error)\r\n    })\r\n    // 响应拦截\r\n    instance.interceptors.response.use(res => {\r\n      this.destroy(url)\r\n      const { data, status } = res\r\n      return { data, status }\r\n    }, error => {\r\n      this.destroy(url)\r\n      addErrorLog(error.response)\r\n      return Promise.reject(error)\r\n    })\r\n  }\r\n  request (options) {\r\n    const instance = axios.create()\r\n    options = Object.assign(this.getInsideConfig(), options)\r\n    this.interceptors(instance, options.url)\r\n    return instance(options)\r\n  }\r\n}\r\nexport default HttpRequest\r\n"]}]}
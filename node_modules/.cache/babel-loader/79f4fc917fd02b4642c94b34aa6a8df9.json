{"remainingRequest":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\src\\components\\main\\components\\user\\user.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\src\\components\\main\\components\\user\\user.vue","mtime":1618817111118},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\.babelrc","mtime":1567648062203},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1618890453389},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1529635966000},{"path":"C:\\Users\\茹家豪\\Desktop\\20210416_rujh_vue\\20210416_rujh_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport _objectSpread from \"C:\\\\Users\\\\\\u8339\\u5BB6\\u8C6A\\\\Desktop\\\\20210416_rujh_vue\\\\20210416_rujh_vue\\\\node_modules\\\\@babel\\\\runtime/helpers/builtin/es6/objectSpread\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport './user.less';\nimport { hasOneOf } from '@/libs/tools';\nimport { mapActions } from 'vuex';\nimport ds from '@/assets/images/ds.png';\nimport { updateCurrent, updateCurrent1, removeCurrentPic, updateCurrentPic, selectNewsCount } from '@/api/data';\nexport default {\n  // inject:['reload'],\n  name: 'User',\n  props: {\n    userAvator: {\n      type: String,\n      default: ''\n    }\n  },\n  data: function data() {\n    return {\n      formData: {},\n      //表单信息\n      saveItem: false,\n      //保存操作框\n      saveItemStatu: false,\n      //保存点击状态\n      itemTitle: '编辑个人信息',\n      saveItem1: false,\n      itemTitle1: '修改密码',\n      upLoadPic: false,\n      // 照片上传模态框\n      spicture: [],\n      //照片上传\n      teacherId: 0,\n      //照片上传参数\n      // 图片上传\n      defaultList: [],\n      imgName: '',\n      picShow: false,\n      uploadList: [],\n      count: 0,\n      content: ds.png\n    };\n  },\n  methods: _objectSpread({}, mapActions(['handleLogOut']), {\n    handleClick: function handleClick(name) {\n      var _this2 = this;\n\n      switch (name) {\n        case 'logout':\n          this.handleLogOut().then(function () {\n            _this2.$router.push({\n              name: 'login'\n            });\n          });\n          break;\n\n        case 'edit':\n          //alert(1);\n          this.saveItem = true;\n          this.formData = this.$store.state.user;\n          break;\n\n        case 'upassword':\n          this.saveItem1 = true;\n          this.formData = this.$store.state.user;\n          break;\n\n        case 'upic':\n          this.upLoadPic = true;\n          console.log(JSON.stringify(this.$store.state.user));\n          this.userId = this.$store.state.user.userId;\n          var defaultPicObj = {};\n          defaultPicObj.name = this.$store.state.user.headPic;\n          defaultPicObj.url = this.$store.state.user.avatorImgPath;\n          this.uploadList.push(defaultPicObj);\n      }\n    },\n    closeUpload: function closeUpload() {\n      alert(1);\n      this.upLoadPic = false;\n      this.defaultList = [];\n      this.uploadList = [];\n      location.reload();\n    },\n    // 图片上传\n    handleView: function handleView(name) {\n      this.imgName = name;\n      this.picShow = true;\n    },\n    handleRemove: function handleRemove(file) {\n      var _this3 = this;\n\n      /*const fileList = this.$refs.upload.fileList;\r\n      this.$refs.upload.fileList.splice(fileList.indexOf(file), 1);*/\n      this.formData.id = this.userId;\n      this.formData.headPic = this.$store.state.user.headPic;\n      removeCurrentPic(this.formData).then(function (res) {\n        //console.log(JSON.stringify(res));\n        if (res.data.success) {\n          _this3.$Message.success({\n            content: '删除头像成功'\n          });\n\n          _this3.uploadList.splice(_this3.uploadList.indexOf(file), 1); //this.upLoadPic = false;\n          //that.pageInit();\n\n        } else if (res.data.errorMsg) {\n          _this3.$Message.warning({\n            content: res.data.errorMsg\n          });\n        }\n      });\n    },\n    handleSuccess: function handleSuccess(res, file) {\n      //alert(1);\n      file.url = 'http://localhost:8081/picture/' + this.$store.state.user.headPic;\n      file.name = res.result.picName;\n      console.log(file.url);\n    },\n    handleFormatError: function handleFormatError(file) {\n      this.$Notice.warning({\n        title: '文件格式不正确',\n        desc: file.name + ' 的文件格式不正确,请选择jpg或png'\n      });\n    },\n    handleMaxSize: function handleMaxSize(file) {\n      this.$Notice.warning({\n        title: '超过文件大小限制',\n        desc: file.name + ' 超出文件大小限制,请选择小于2M的图片上传'\n      });\n    },\n    handleBeforeUpload: function handleBeforeUpload(file) {\n      // 创建一个 FileReader 对象\n      var reader = new FileReader(); // readAsDataURL 方法用于读取指定 Blob 或 File 的内容\n      // 当读操作完成，readyState 变为 DONE，loadend 被触发，此时 result 属性包含数据：URL（以 base64 编码的字符串表示文件的数据）\n      // 读取文件作为 URL 可访问地址\n\n      reader.readAsDataURL(file);\n\n      var _this = this;\n\n      reader.onloadend = function (e) {\n        file.url = reader.result;\n\n        _this.uploadList.push(file);\n      };\n\n      var check = this.uploadList.length < 1;\n\n      if (!check) {\n        this.$Notice.warning({\n          title: '最多可上传1张图片'\n        });\n      }\n\n      return check;\n    },\n    // 关闭保存项目模态框\n    closeSaveItem: function closeSaveItem() {\n      this.formData = {};\n      this.saveItem = false;\n      this.targetKeys = [];\n      this.saveItem1 = false;\n    },\n    saveItemOk: function saveItemOk() {\n      var _this4 = this;\n\n      var that = this;\n      var formData = this.formData;\n      console.log(JSON.stringify(formData));\n\n      if (!formData.name) {\n        this.$Message.warning({\n          content: '请填写您的姓名！'\n        });\n        return;\n      } else if (!/[\\u4e00-\\u9fa5_a-zA-Z]+$/.test(formData.name)) {\n        this.$Message.warning({\n          content: '请填写正确的姓名'\n        });\n        return;\n      }\n\n      ;\n\n      if (!formData.phone) {\n        this.$Message.warning({\n          content: '请填写您的手机号'\n        });\n        return;\n      } else if (!/^1(3|4|5|6|7|8)\\d{9}$/.test(formData.phone)) {\n        this.$Message.warning({\n          content: '请填写正确的手机号'\n        });\n        return;\n      }\n\n      ;\n      updateCurrent(this.formData).then(function (res) {\n        that.saveItemStatu = false;\n\n        if (res.data.success) {\n          _this4.$Message.success({\n            content: '修改用户成功'\n          });\n\n          that.saveItem = false;\n          that.pageInit();\n        } else if (res.data.errorMsg) {\n          _this4.$Message.warning({\n            content: res.data.errorMsg\n          });\n        }\n      });\n    },\n    saveItemOk1: function saveItemOk1() {\n      var _this5 = this;\n\n      var that = this;\n      var formData = this.formData; //console.log('55555'+JSON.stringify(formData))\n\n      if (!formData.oldPassword) {\n        this.$Message.warning({\n          content: '请填写您的旧密码！'\n        });\n        return;\n      } else if (!/^[\\w_-]{5,11}$/.test(formData.oldPassword)) {\n        this.$Message.warning({\n          content: '请填写5-11密码'\n        });\n        return;\n      }\n\n      ;\n\n      if (!formData.newPassword) {\n        this.$Message.warning({\n          content: '请填写您的新密码！'\n        });\n        return;\n      } else if (!/^[\\w_-]{5,11}$/.test(formData.newPassword)) {\n        this.$Message.warning({\n          content: '请填写5-11密码'\n        });\n        return;\n      }\n\n      ;\n\n      if (!formData.confirmPwd) {\n        this.$Message.warning({\n          content: '请确认您的密码！'\n        });\n        return;\n      } else if (formData.confirmPwd !== formData.newPassword) {\n        this.$Message.warning({\n          content: '两次密码请保持一致'\n        });\n        return;\n      }\n\n      ; //console.log(JSON.stringify(this.identity))\n      //    this.saveItemStatu = true;\n\n      updateCurrent1(this.formData).then(function (res) {\n        // var that = this;\n        that.saveItemStatu = false;\n\n        if (res.data.success) {\n          _this5.$Message.success({\n            content: '修改密码成功'\n          });\n\n          that.saveItem1 = false;\n          that.pageInit();\n        } else if (res.data.errorMsg) {\n          _this5.$Message.warning({\n            content: res.data.errorMsg\n          });\n        }\n      });\n    }\n  }),\n  mounted: function mounted() {\n    var _this6 = this;\n\n    selectNewsCount().then(function (res) {\n      if (res.data.success) {\n        _this6.count = res.data.result.count;\n      } else if (res.data.errorMsg) {\n        _this6.$Message.warning({\n          content: res.data.errorMsg\n        });\n      }\n    });\n  },\n  computed: {\n    access: function access() {\n      return this.$store.state.user.access;\n    },\n    newsCount: function newsCount() {\n      return this.$store.state.user.newsCount;\n    },\n    //所有权限\n    viewAccessAll: function viewAccessAll() {\n      return hasOneOf(['superAdmin', 'teacher', 'student'], this.access);\n    },\n    //部分权限\n    viewAccessTwo: function viewAccessTwo() {\n      return hasOneOf(['teacher', 'student'], this.access);\n    }\n  }\n};",{"version":3,"sources":["user.vue"],"names":[],"mappings":"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","sourcesContent":["<style>\r\n    .demo-upload-list{\r\n        display: inline-block;\r\n        width: 60px;\r\n        height: 60px;\r\n        text-align: center;\r\n        line-height: 60px;\r\n        border: 1px solid transparent;\r\n        border-radius: 4px;\r\n        overflow: hidden;\r\n        background: #fff;\r\n        position: relative;\r\n        box-shadow: 0 1px 1px rgba(0,0,0,.2);\r\n        margin-right: 4px;\r\n    }\r\n    .demo-upload-list img{\r\n        width: 100%;\r\n        height: 100%;\r\n    }\r\n    .demo-upload-list-cover{\r\n        display: none;\r\n        position: absolute;\r\n        top: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        background: rgba(0,0,0,.6);\r\n    }\r\n    .demo-upload-list:hover .demo-upload-list-cover{\r\n        display: block;\r\n    }\r\n    .demo-upload-list-cover i{\r\n        color: #fff;\r\n        font-size: 20px;\r\n        cursor: pointer;\r\n        margin: 0 2px;\r\n    }\r\n</style>\r\n\r\n\r\n<template>\r\n  \r\n  <div class=\"user-avator-dropdown\">\r\n     <Badge :count=\"newsCount\" :offset=\"[20,5]\" class=\"mr-10\" >\r\n        <a href=\"http://localhost:8081/#/news/news\"><Icon type=\"ios-notifications-outline\" size=\"26\"></Icon></a>\r\n      </Badge>\r\n    <Dropdown @on-click=\"handleClick\">\r\n      <Avatar :src=\"userAvator\"/>\r\n      <Icon :size=\"18\" type=\"md-arrow-dropdown\"></Icon>\r\n      <DropdownMenu slot=\"list\">\r\n         <component2 v-if=\"viewAccessTwo\"> \r\n            <DropdownItem name=\"edit\" >编辑个人信息</DropdownItem>\r\n            <DropdownItem name=\"upassword\" >修改密码</DropdownItem>\r\n            <DropdownItem name=\"upic\" >修改头像</DropdownItem> \r\n         </component2> \r\n          <DropdownItem name=\"logout\">退出登录</DropdownItem>\r\n      </DropdownMenu>\r\n    </Dropdown>\r\n    <Modal\r\n     v-model=\"saveItem\"\r\n     :title=\"itemTitle\"\r\n     @on-cancel='closeSaveItem'>\r\n     <Form ref=\"formData\" :model=\"formData\" :label-width=\"80\">\r\n       <input type=\"hidden\" name='id' v-model=\"formData.userId\">\r\n       <FormItem label=\"姓名\">\r\n           <Input v-model=\"formData.name\" placeholder=\"请填写您的姓名\" :maxlength=\"10\"></Input>\r\n       </FormItem>\r\n       <FormItem label=\"手机号\">\r\n           <Input v-model=\"formData.phone\" placeholder=\"请填写您的手机号码\" :maxlength=\"11\"></Input>\r\n       </FormItem>\r\n     </Form>\r\n     <div slot=\"footer\">\r\n         <Button type=\"default\"  @click=\"closeSaveItem\">关闭</Button>\r\n         <Button type=\"primary\" :disabled='saveItemStatu'  @click=\"saveItemOk\">确认</Button>\r\n     </div>\r\n   </Modal> \r\n   <Modal\r\n     v-model=\"saveItem1\"\r\n     :title=\"itemTitle1\"\r\n     @on-cancel='closeSaveItem'>\r\n     <Form ref=\"formData\" :model=\"formData\" :label-width=\"80\">\r\n       <input type=\"hidden\" name='id' v-model=\"formData.userId\">\r\n         <FormItem label=\"旧密码\" >\r\n           <Input  v-model=\"formData.oldPassword\" placeholder=\"请填写您的旧密码\" :maxlength=\"11\"></Input>\r\n         </FormItem>\r\n         <FormItem label=\"新密码\">\r\n            <Input type='password' v-model=\"formData.newPassword\" placeholder=\"请填写您的新密码\" :maxlength=\"11\"></Input>\r\n          </FormItem>\r\n         <FormItem label=\"确认密码\" >\r\n            <Input type='password' v-model=\"formData.confirmPwd\" placeholder=\"请确认新密码\" :maxlength=\"11\"></Input>\r\n          </FormItem> \r\n     </Form>\r\n     <div slot=\"footer\">\r\n         <Button type=\"default\"  @click=\"closeSaveItem\">关闭</Button>\r\n         <Button type=\"primary\" :disabled='saveItemStatu'  @click=\"saveItemOk1\">确认</Button>\r\n     </div>\r\n   </Modal> \r\n\r\n   <Modal\r\n      v-model=\"upLoadPic\"\r\n      title=\"上传头像\"\r\n      @on-cancel='closeUpload'>\r\n      <div class=\"demo-upload-list\" v-for=\"item in uploadList\">\r\n          <img :src=\"item.url\">\r\n          <div class=\"demo-upload-list-cover\">\r\n              <Icon type=\"ios-trash-outline\" @click.native=\"handleRemove(item)\"></Icon>\r\n          </div>\r\n      </div>\r\n      <Upload\r\n          ref=\"upload\"\r\n          :show-upload-list=\"false\"\r\n          :default-file-list=\"defaultList\"\r\n          :on-success=\"handleSuccess\"\r\n          :format=\"['jpg','jpeg','png']\"\r\n          :max-size=\"2048\"\r\n          :on-format-error=\"handleFormatError\"\r\n          :on-exceeded-size=\"handleMaxSize\"\r\n          :before-upload=\"handleBeforeUpload\"\r\n          multiple\r\n          type=\"drag\"\r\n          action=\"/api/current/updateCurrentPic\"\r\n          :headers=\"{userId:userId}\"\r\n          style=\"display: inline-block;width:58px;\">\r\n          <div style=\"width: 58px;height:58px;line-height: 58px;\">\r\n              <Icon type=\"ios-camera\" size=\"20\"></Icon>\r\n          </div>\r\n      </Upload>\r\n      <div slot=\"footer\">\r\n          <Button type=\"default\"  @click=\"closeUpload\">关闭</Button>\r\n      </div>\r\n    </Modal>\r\n    <Modal title=\"View Image\" v-model=\"picShow\">\r\n        <img :src=\"'https://o5wwk8baw.qnssl.com/' + imgName + '/large'\" v-if=\"picShow\" style=\"width: 100%\">\r\n    </Modal>\r\n </div>\r\n\r\n</template>\r\n\r\n<script>\r\n\r\nimport './user.less'\r\nimport { hasOneOf } from '@/libs/tools'\r\nimport { mapActions } from 'vuex'\r\nimport ds from '@/assets/images/ds.png' \r\nimport { updateCurrent , updateCurrent1,removeCurrentPic,updateCurrentPic,selectNewsCount} from '@/api/data'\r\n\r\nexport default {\r\n // inject:['reload'],\r\n  name: 'User',\r\n  props: {\r\n    userAvator: {\r\n      type: String,\r\n      default: ''\r\n    }\r\n  },\r\n  data () {\r\n    return {\r\n      formData:{},      //表单信息\r\n      saveItem:false,     //保存操作框\r\n      saveItemStatu:false,    //保存点击状态\r\n      itemTitle:'编辑个人信息',\r\n\r\n      saveItem1:false,\r\n      itemTitle1:'修改密码',\r\n\r\n      upLoadPic: false,   // 照片上传模态框\r\n      spicture:[],          //照片上传\r\n      teacherId:0,        //照片上传参数\r\n\r\n      // 图片上传\r\n      defaultList: [],\r\n      imgName: '',\r\n      picShow: false,\r\n      uploadList: [],\r\n\r\n      count:0,\r\n      content:ds.png,\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions([\r\n      'handleLogOut'\r\n    ]),\r\n    handleClick (name) {\r\n      switch (name) {\r\n        case 'logout':\r\n          this.handleLogOut().then(() => {\r\n            this.$router.push({\r\n              name: 'login'\r\n            })\r\n          })\r\n          break;\r\n        case 'edit':\r\n        //alert(1);\r\n        this.saveItem = true;\r\n        this.formData = this.$store.state.user;\r\n        break;\r\n        case 'upassword' :\r\n        this.saveItem1 = true;\r\n        this.formData = this.$store.state.user;\r\n        break;\r\n        case 'upic' :\r\n        this.upLoadPic = true;\r\n        console.log(JSON.stringify(this.$store.state.user))\r\n        this.userId = this.$store.state.user.userId;\r\n        var defaultPicObj = {};\r\n            defaultPicObj.name=this.$store.state.user.headPic;\r\n            defaultPicObj.url=this.$store.state.user.avatorImgPath;\r\n            this.uploadList.push(defaultPicObj);\r\n      }\r\n    },\r\n\r\n    closeUpload(){\r\n     alert(1);\r\n      this.upLoadPic = false;\r\n      this.defaultList=[];\r\n      this.uploadList=[];\r\n      location.reload();\r\n    },\r\n\r\n    // 图片上传\r\n    handleView (name) {\r\n        this.imgName = name;\r\n        this.picShow = true;\r\n    },\r\n    handleRemove (file) {\r\n        /*const fileList = this.$refs.upload.fileList;\r\n        this.$refs.upload.fileList.splice(fileList.indexOf(file), 1);*/\r\n        this.formData.id=this.userId;\r\n        this.formData.headPic=this.$store.state.user.headPic;\r\n        removeCurrentPic(this.formData).then(res => {\r\n            //console.log(JSON.stringify(res));\r\n            if(res.data.success){\r\n              this.$Message.success({\r\n              content:'删除头像成功'\r\n            });\r\n             this.uploadList.splice(this.uploadList.indexOf(file), 1)\r\n             //this.upLoadPic = false;\r\n             //that.pageInit();\r\n            }else if(res.data.errorMsg){\r\n              this.$Message.warning({\r\n                content:res.data.errorMsg\r\n              })\r\n            }\r\n          })\r\n    },\r\n     handleSuccess (res, file) {\r\n        //alert(1);\r\n        file.url = 'http://localhost:8081/picture/'+this.$store.state.user.headPic;\r\n        file.name = res.result.picName;\r\n        console.log(file.url);\r\n    },\r\n    handleFormatError (file) {\r\n        this.$Notice.warning({\r\n            title: '文件格式不正确',\r\n            desc: file.name + ' 的文件格式不正确,请选择jpg或png'\r\n        });\r\n    },\r\n    handleMaxSize (file) {\r\n        this.$Notice.warning({\r\n            title: '超过文件大小限制',\r\n            desc: file.name + ' 超出文件大小限制,请选择小于2M的图片上传'\r\n        });\r\n    },\r\n     handleBeforeUpload(file) {\r\n        // 创建一个 FileReader 对象\r\n        let reader = new FileReader()\r\n        // readAsDataURL 方法用于读取指定 Blob 或 File 的内容\r\n        // 当读操作完成，readyState 变为 DONE，loadend 被触发，此时 result 属性包含数据：URL（以 base64 编码的字符串表示文件的数据）\r\n        // 读取文件作为 URL 可访问地址\r\n        reader.readAsDataURL(file)\r\n\r\n        const _this = this\r\n        reader.onloadend = function (e) {\r\n            file.url = reader.result\r\n            _this.uploadList.push(file)\r\n        }\r\n        const check = this.uploadList.length < 1;\r\n        if (!check) {\r\n            this.$Notice.warning({\r\n                title: '最多可上传1张图片'\r\n            });\r\n        }\r\n        return check;\r\n    },\r\n   // 关闭保存项目模态框\r\n    closeSaveItem(){\r\n      this.formData = {};\r\n      this.saveItem = false;\r\n      this.targetKeys=[];\r\n      this.saveItem1 = false;\r\n    },\r\n    saveItemOk(){\r\n      var that = this;\r\n      var formData = this.formData;\r\n      console.log(JSON.stringify(formData))\r\n      if(!formData.name){\r\n        this.$Message.warning({\r\n          content:'请填写您的姓名！'\r\n        });\r\n        return;\r\n      }else if (!/[\\u4e00-\\u9fa5_a-zA-Z]+$/.test(formData.name)){\r\n        this.$Message.warning({\r\n          content:'请填写正确的姓名'\r\n        });\r\n        return;\r\n      };\r\n      \r\n      if(!formData.phone){\r\n        this.$Message.warning({\r\n          content:'请填写您的手机号'\r\n        });\r\n        return;\r\n      }else if (!/^1(3|4|5|6|7|8)\\d{9}$/.test(formData.phone)){\r\n        this.$Message.warning({\r\n          content:'请填写正确的手机号'\r\n        });\r\n        return;\r\n      };\r\n        updateCurrent(this.formData).then(res => {\r\n          that.saveItemStatu = false;\r\n          if(res.data.success){\r\n            this.$Message.success({\r\n              content:'修改用户成功'\r\n            });\r\n            that.saveItem = false;\r\n            that.pageInit();\r\n          }else if(res.data.errorMsg){\r\n            this.$Message.warning({\r\n              content:res.data.errorMsg\r\n            })\r\n          }\r\n        })\r\n    },\r\n\r\n\r\n\r\n    saveItemOk1(){\r\n      var that = this;\r\n      var formData = this.formData;\r\n      //console.log('55555'+JSON.stringify(formData))\r\n        if(!formData.oldPassword){\r\n          this.$Message.warning({\r\n            content:'请填写您的旧密码！'\r\n          });\r\n          return;\r\n        }else if (!/^[\\w_-]{5,11}$/.test(formData.oldPassword)){\r\n          this.$Message.warning({\r\n            content:'请填写5-11密码'\r\n          });\r\n          return;\r\n        };\r\n        if(!formData.newPassword){\r\n          this.$Message.warning({\r\n            content:'请填写您的新密码！'\r\n          });\r\n          return;\r\n        }else if (!/^[\\w_-]{5,11}$/.test(formData.newPassword)){\r\n          this.$Message.warning({\r\n            content:'请填写5-11密码'\r\n          });\r\n          return;\r\n        };\r\n        if(!formData.confirmPwd){\r\n          this.$Message.warning({\r\n            content:'请确认您的密码！'\r\n          });\r\n          return;\r\n        }else if (formData.confirmPwd !== formData.newPassword){\r\n          this.$Message.warning({\r\n            content:'两次密码请保持一致'\r\n          });\r\n          return;\r\n        };\r\n        //console.log(JSON.stringify(this.identity))\r\n    //    this.saveItemStatu = true;\r\n        updateCurrent1(this.formData).then(res => {\r\n          // var that = this;\r\n          that.saveItemStatu = false;\r\n          if(res.data.success){\r\n            this.$Message.success({\r\n              content:'修改密码成功'\r\n            });\r\n            that.saveItem1 = false;\r\n            that.pageInit();\r\n          }else if(res.data.errorMsg){\r\n            this.$Message.warning({\r\n              content:res.data.errorMsg\r\n            })\r\n          }\r\n        })\r\n    }\r\n  },\r\n  mounted () {\r\n    selectNewsCount().then(res => {\r\n      if(res.data.success){\r\n        this.count = res.data.result.count;\r\n      }else if(res.data.errorMsg){\r\n        this.$Message.warning({\r\n          content:res.data.errorMsg\r\n        })\r\n      }\r\n    })\r\n  },\r\n  computed: { \r\n      access () {\r\n        return this.$store.state.user.access\r\n      },\r\n\r\n      newsCount(){\r\n        return this.$store.state.user.newsCount\r\n      },\r\n      //所有权限\r\n      viewAccessAll () {\r\n        return hasOneOf(['superAdmin', 'teacher','student'], this.access)\r\n      },\r\n      //部分权限\r\n      viewAccessTwo () {\r\n        return hasOneOf(['teacher','student'], this.access)\r\n      }\r\n    }\r\n}\r\n\r\n</script>\r\n"],"sourceRoot":"src\\components\\main\\components\\user"}]}